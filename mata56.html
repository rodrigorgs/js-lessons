<!DOCTYPE html>
<html>
<title>js-lessons</title>
<meta charset="utf-8">
<!-- Theses are just icons config - created with realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="57x57" href="assets/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="assets/images/icons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="assets/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="assets/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="assets/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="assets/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="assets/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="assets/images/icons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="assets/images/icons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="assets/images/icons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="assets/images/icons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="assets/images/icons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="assets/images/icons/manifest.json">
<link rel="mask-icon" href="assets/images/icons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="assets/images/icons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-TileImage" content="assets/images/icons/mstile-144x144.png">
<meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- These are just code mirror templates for editor -->
<link rel="stylesheet" href="assets/codemirror/theme/3024-day.css">
<link rel="stylesheet" href="assets/codemirror/theme/3024-night.css">
<link rel="stylesheet" href="assets/codemirror/theme/abcdef.css">
<link rel="stylesheet" href="assets/codemirror/theme/ambiance.css">
<link rel="stylesheet" href="assets/codemirror/theme/base16-dark.css">
<link rel="stylesheet" href="assets/codemirror/theme/bespin.css">
<link rel="stylesheet" href="assets/codemirror/theme/base16-light.css">
<link rel="stylesheet" href="assets/codemirror/theme/blackboard.css">
<link rel="stylesheet" href="assets/codemirror/theme/cobalt.css">
<link rel="stylesheet" href="assets/codemirror/theme/colorforth.css">
<link rel="stylesheet" href="assets/codemirror/theme/dracula.css">
<link rel="stylesheet" href="assets/codemirror/theme/eclipse.css">
<link rel="stylesheet" href="assets/codemirror/theme/elegant.css">
<link rel="stylesheet" href="assets/codemirror/theme/erlang-dark.css">
<link rel="stylesheet" href="assets/codemirror/theme/hopscotch.css">
<link rel="stylesheet" href="assets/codemirror/theme/icecoder.css">
<link rel="stylesheet" href="assets/codemirror/theme/isotope.css">
<link rel="stylesheet" href="assets/codemirror/theme/lesser-dark.css">
<link rel="stylesheet" href="assets/codemirror/theme/liquibyte.css">
<link rel="stylesheet" href="assets/codemirror/theme/material.css">
<link rel="stylesheet" href="assets/codemirror/theme/mbo.css">
<link rel="stylesheet" href="assets/codemirror/theme/mdn-like.css">
<link rel="stylesheet" href="assets/codemirror/theme/midnight.css">
<link rel="stylesheet" href="assets/codemirror/theme/monokai.css">
<link rel="stylesheet" href="assets/codemirror/theme/neat.css">
<link rel="stylesheet" href="assets/codemirror/theme/neo.css">
<link rel="stylesheet" href="assets/codemirror/theme/night.css">
<link rel="stylesheet" href="assets/codemirror/theme/paraiso-dark.css">
<link rel="stylesheet" href="assets/codemirror/theme/paraiso-light.css">
<link rel="stylesheet" href="assets/codemirror/theme/pastel-on-dark.css">
<link rel="stylesheet" href="assets/codemirror/theme/railscasts.css">
<link rel="stylesheet" href="assets/codemirror/theme/rubyblue.css">
<link rel="stylesheet" href="assets/codemirror/theme/seti.css">
<link rel="stylesheet" href="assets/codemirror/theme/solarized.css">
<link rel="stylesheet" href="assets/codemirror/theme/the-matrix.css">
<link rel="stylesheet" href="assets/codemirror/theme/tomorrow-night-bright.css">
<link rel="stylesheet" href="assets/codemirror/theme/tomorrow-night-eighties.css">
<link rel="stylesheet" href="assets/codemirror/theme/ttcn.css">
<link rel="stylesheet" href="assets/codemirror/theme/twilight.css">
<link rel="stylesheet" href="assets/codemirror/theme/vibrant-ink.css">
<link rel="stylesheet" href="assets/codemirror/theme/xq-dark.css">
<link rel="stylesheet" href="assets/codemirror/theme/xq-light.css">
<link rel="stylesheet" href="assets/codemirror/theme/yeti.css">
<link rel="stylesheet" href="assets/codemirror/theme/zenburn.css">
<!-- You can remove or leave at is -->
<!-- Stylesheets system - please don't remove :) -->
<link rel="stylesheet" href="assets/main.css">
<link rel="stylesheet" href="assets/codemirror/codemirror.css">
<link rel="stylesheet" href="assets/codemirror/addons/show-hint.css">
<link rel="stylesheet" href="assets/codemirror/addons/lint.css">
<link rel="stylesheet" href="assets/codemirror/addons/fullscreen.css">
<script type="text/javascript">
	// Adds the implementation for Array.prototype.concatAll()
	function defineConcatAll() {
		Array.prototype.concatAll = function () {
			var results = [];

			this.forEach(function(subArray) {
				results.push.apply(results, subArray);
			});

			return results;
		};
	}

	/**
	 * Add the implementation for Array.prototype.concatMap()
	 */
	function defineConcatMap() {
		Array.prototype.concatMap = function(fnc) {
			return this.
				map(function (e) {
					return fnc(e);
				}).
				// apply the concatAll function to flatten the two-dimensional array
				concatAll();
		};
	}

	/**
	 * This function will be executed at the begining of each verifier function
	 */
	function preVerifierHook() {
		// Add helpers to prevent 'undefined is not a function' like errors
		defineConcatAll();
		defineConcatMap();
	}

	function showLessonErrorMessage(exp, got, note, div){
		var preTag;
		var expected = JSON.stringify(JSON.parse(exp), undefined, 4);

		div.innerHTML = "<h4>Expected:</h4>";
		preTag = document.createElement("pre");
		preTag.innerHTML += expected;
		div.appendChild(preTag);
		div.innerHTML += "<h4>Got:</h4>";
		preTag = document.createElement("pre");
		preTag.innerHTML += got;
		div.appendChild(preTag);
		
		div.innerHTML += (note !== "") ? ("<h4>Note</h4><p style=\"margin-left: 25px;\">" + note + "</p>") : ""; 
		div.className = "info";
	}
</script>

<!--- DEFINE BEGIN OF THE MARKDOWN AREA  -->
<xmp theme="united" style="display:none;">
<div id="loader-wrapper">
	<div id="loader"></div>
	<div class="loader-section section-left"></div>
	<div class="loader-section section-right"></div>
</div>

# Programação funcional
## Nomes, vinculação e escopo
---

### Note on Interactive Exercises 

js-lessons is not just a "tutorial", is much more than that, js-lessons is a **series of interactive exercises that you 
can fill out right in your browser!** dude! It's awesome just edit the code according to the question and hit "Run",
if the code is working you can proceed to the next question, if don't the error will appear and you just need to
correct and hit go again, until the code works, nice uh!?

** Note 1: ** Use "F4" key to toggle full screen mode in editor, and press "ESC" or "F4" to leave this mode;

** Note 2: ** You can use "CTRL + SPACE" to active autocomplete; 

** Note 3: ** Every "console.log()", below each question will appear in output div;

** Note 4: ** We use jshint to check the syntax of your code, but you can disable this too;

** Note 5: ** You can choose the template of the page and the editors. We have a beta version too
[js-lessons.BETA](beta.html), with a beta version of strapdown, which is not recomended.

** ! This exercise is just for test purpose, and documentation, so don't use it for real learning. **

### Personal Configurations

<p style="margin-bottom:0;"> <b> Select a theme for CodeMirror editors </b><br>
<select style="margin-top: 5px;" onchange="selectTheme()" id="select">
    <option selected="">default</option>
    <option>3024-day</option>
    <option>3024-night</option>
    <option>abcdef</option>
    <option>ambiance</option>
    <option>base16-dark</option>
    <option>base16-light</option>
    <option>bespin</option>
    <option>blackboard</option>
    <option>cobalt</option>
    <option>colorforth</option>
    <option>dracula</option>
    <option>eclipse</option>
    <option>elegant</option>
    <option>erlang-dark</option>
    <option>hopscotch</option>
    <option>icecoder</option>
    <option>isotope</option>
    <option>lesser-dark</option>
    <option>liquibyte</option>
    <option>material</option>
    <option>mbo</option>
    <option>mdn-like</option>
    <option>midnight</option>
    <option>monokai</option>
    <option>neat</option>
    <option>neo</option>
    <option>night</option>
    <option>paraiso-dark</option>
    <option>paraiso-light</option>
    <option>pastel-on-dark</option>
    <option>railscasts</option>
    <option>rubyblue</option>
    <option>seti</option>
    <option>solarized dark</option>
    <option>solarized light</option>
    <option>the-matrix</option>
    <option>tomorrow-night-bright</option>
    <option>tomorrow-night-eighties</option>
    <option>ttcn</option>
    <option>twilight</option>
    <option>vibrant-ink</option>
    <option>xq-dark</option>
    <option>xq-light</option>
    <option>yeti</option>
    <option>zenburn</option>
</select>
</p><p style="margin-bottom:0;"> <b> Select a theme for this page </b><br>
<select style="margin-top: 5px;" onchange="selectThemePage(this)" id="selectpage">
    <option selected="">united</option>
    <option>amelia</option>
    <option>cerulean</option>
    <option>cyborg</option>
    <option>journal</option>
    <option>readable</option>
    <option>simplex</option>
    <option>slate</option>
    <option>spacelab</option>
    <option>spruce</option>
    <option>superhero</option>
</select>

## Introdução

Em programas de computador, **nomes** representam coisas, como valores, comportamentos etc. Os nomes são **vinculados** às coisas que representam em diversos momentos. Por exemplo:

* O nome `if` é vinculado ao comportamento de estrutura de seleção em **tempo de projeto de linguagem**
* Em C, quando você escreve `#define PI 3.14159`, o nome `PI` é vinculado ao valor `3.14159` em **tempo de compilação**
* Em geral, variáveis são vinculadas aos seus valores em **tempo de execução**

Em linguagens de programação, vinculação (ou amarração, ou ligação, ou binding) se refere à vinculação de um nome a um valor ou comportamento.

**Escopo** de uma vinculação é o conjunto de trechos de um programa que consegue usar a vinculação. Exemplo:

```javascript
var glob = 123;     // 1
console.log(glob);  // 2
function teste() {  // 3
    var x = 2;      // 4
    console.log(x); // 5
}                   // 6
glob = 456;         // 7
```

O escopo da variável `glob` corresponde às linhas 2, 4, 5 e 7 do programa. O escopo da variável `x` corresponde à linha 5.

A variável `glob` tem um escopo **global**, pois é acessível em todo o programa (essa é uma definição simplificada). A variável `x` tem um escopo **local**, pois só é acessível dentro da função no qual ela é definida. A variável `teste` também possui escopo global (lembre-se de que em Javascript funções também são valores!).

A maioria das linguagens de programação adota regras de **escopo léxico** (ou estático). Isso significa que é possível determinar o escopo de uma variável somente lendo o código-fonte do programa. Algumas linguagens de programação usam o **escopo dinâmico**; uma situação comum nesse caso é uma função ter acesso a variáveis definidas na função que a chamou. Pode-se argumentar que uma linguagem de programação que adota o escopo dinâmico tende a resultar em programas mais difíceis de entender.

O **contexto** ou **ambiente de referenciamento** de uma região de um programa corresponde ao conjunto de vinculações que pode-se acessar naquela região. Vejamos o exemplo anterior:

```javascript
var glob = 123;     // 1
console.log(glob);  // 2
function teste() {  // 3
    var x = 2;      // 4
    console.log(x); // 5
}                   // 6
glob = 456;         // 7
```

O ambiente de referenciamento da linha 7 corresponde às variáveis `glob` e `teste` (e, naturalmente, outras variáveis definidas globalmente pelo browser, a exemplo de `window` e `console`). O ambiente de referenciamento da linha 5 contém todas essas variáveis e mais a variável `x`.

## Regras de escopo de Javascript

Considere agora o seguinte exemplo:

```javascript
/* 1  */ var glob = 1;
/* 2  */ 
/* 3  */ function externa() {
/* 4  */     var xext = 2;
/* 5  */ 
/* 6  */     function interna() {
/* 7  */         var xint = 3;
/* 8  */         console.log(xext);
/* 9  */     }
/* 10 */     interna();
/* 11 */ }
/* 12 */ externa();
```

O que acontecerá quando a linha 8 for executada? Vai dar erro? Para responder a essa pergunta, devemos descobrir se a variável `xext` faz ou não faz parte do ambiente de referenciamento da linha 8 (e da função `interna`, em geral).

Faça suas apostas e execute o código no console do seu navegador.

Para buscar da variável `xint`, o interpretador Javascript primeiro procura nas variáveis definidas dentro da função `interna`. Não encontrando, ele vai procurar variáveis definidas no contexto da função `externa`. Se ainda não encontrar, procura nas variáveis globais. Ou seja, o ambiente de referenciamento inclui o escopo atual e mais todos os escopos externos.

Então o que vai acontecer no seguinte código?

```javascript
/* 1  */ var x = 1;
/* 2  */ 
/* 3  */ function externa() {
/* 4  */     var x = 2;
/* 5  */ 
/* 6  */     function interna() {
/* 7  */         var x = 3;
/* 8  */         console.log(x);
/* 9  */     }
/* 10 */     interna();
/* 11 */ }
/* 12 */ externa();
```

Existem três vinculações diferentes do nome `x`, com diferentes escopos. Surge a dúvida: se o `x` da linha 1 tem escopo global, isso significa que esse escopo se estende à linha 8?

Não. A declaração de `x` na linha 4 **mascara** a variável `x` da linha 1 (esse fenômeno é também conhecido como **sombreamento**. O resultado disso é que, dentro da função `externa`, vale a variável `x` da linha `4`... exceto na linha 8, pois nesse caso a variável que vale é a variável `x` definida na linha 7. 

No final das contas, o escopo de `x` da linha 1 é a linha 12; o escopo de `x` da linha 4 é a linha 10; e o escopo de `x` da linha 7 é a linha 8.

## Closures

(Baseado em https://developer.mozilla.org/en/docs/Web/JavaScript/Closures)

Closures (do inglês, fechamento) são funções que referenciam variáveis independentes (livres). Em outras palavras, a função definida na closure lembra-se do ambiente no qual ele foi criado.

Vamos começar com um exemplo simples, sem closure:

```javascript
function alo() {
    var nome = "Turing";

    function mostraNome() {
        alert("Alo, " + nome);
    }
    mostraNome();
}
alo();
```

Agora um exemplo mais complexo, com closure:

```javascript
function criaFuncaoAlo() {
    var nome = "Turing";

    function mostraNome() {
        alert("Alo, " + nome);
    }
    return mostraNome;
}
var alo = criaFuncaoAlo();
alo();
```

O resultado é o mesmo, mas a função `criaFuncaoAlo` desta vez retorna a função interna `mostraNome`, sem executá-la. Em vez disso, a função só executada na última linha de código.

O código não é muito intuitivo. Normalmente, uma variável local definida em uma função só existe enquanto a função é executada; quando a execução termina, a variável deveria ser destruída e deixar de ser acessível. No exemplo, no entanto, a variável `nome` ainda está acessível depois que a função `criaFuncaoAlo` terminou de executar.

A solução desse mistério é que `mostraNome` tornou-se uma closure, que é um objeto especial que combina duas coisas: uma função e o ambiente na qual a função foi criada. O ambiente consiste de todas as variáveis locais disponíveis no momento em que a função foi criada. Dizemos que a função `mostraNome` **captura** a variável nome.

```
closure mostraNome =
  função mostraNome +
  variável nome
```

Mais um exemplo:

```javascript
function criaAlertRandom() {
    var x = Math.random();
    return function() {
        alert("Número sorteado: " + x);
    }
}
var funcAlert1 = criaAlertRandom();
var funcAlert2 = criaAlertRandom();
funcAlert1();
funcAlert2();
funcAlert1();
```

Qual o resultado? Três números iguais? Três números diferentes? O primeiro número será igual ao terceiro? Faça suas apostas, execute e revise seu conhecimento sobre closures.

Agora um exemplo mais útil, mostrando que parâmetros também são capturados por uma closure:

```javascript
function multiplicador(fator1) {
    return function(fator2) {
        return fator1 * fator2;
    }
}
var dobro = multiplicador(2);
var triplo = multiplicador(3);
alert(dobro(4));
alert(triplo(4));
```

A closure também pode alterar as variáveis capturadas:

```javascript
function criaContador() {
    var x = 0;
    return function() {
        x = x + 1;
        console.log(x);
    }
}
var contadorA = criaContador();
var contadorB = criaContador();
contadorA();
contadorA();
contadorA();
contadorB();
contadorB();
```

## Closures e programação orientada a objetos

Uma closure permite associar alguns dados (o ambiente) com a função que opera sobre os dados. Isso soa como programação orientada a objetos, na qual objetos permitem associar alguns dados (as propriedades do objeto) a um ou mais métodos.

Exemplo:

```javascript
function criaObjetoContador(nome) {
    var c = 0;

    function incrementa() {
        c = c + 1;
    }
    function mostra() {
        alert(nome + ": " + c);
    }

    return {"incrementa": incrementa,
        "mostra": mostra};
}
var contadorA = criaObjetoContador("A");
var contadorB = criaObjetoContador("B");
contadorA.incrementa();
contadorB.incrementa();
contadorA.incrementa();
contadorB.incrementa();
contadorA.incrementa();
contadorA.mostra();
contadorB.mostra();
```

Obviamente, esse esquema é limitado, pois não há herança e polimorfismo. Veremos como fazer programação orientada a objetos em Javascript do jeito certo em outro momento.

## Closures na prática

É importante entender closures para programar Javascript para web? **Muito**! Grande parte do código que escrevemos em Javascript para web é baseado em eventos: definimos um comportamento, então anexamos o comportamento a um evento que é disparado pelo usuário (por exemplo, um clique). O código é geralmente escrito em um callback: uma função que é executada em resposta a um evento.

Exemplo:

<div>
<script async src="http://jsfiddle.net/hr17fgj4/embed/js,html,result/"></script>
</div>

Agora vamos para um exemplo mais complexo:

<div>
<script async src="http://jsfiddle.net/sftqbfj7/embed/js,html,result/"></script>
</div>

Não funcionou como você gostaria? Por quê?

Que tal agora?

<div>
<script async src="http://jsfiddle.net/e1srfbbv/embed/js,html,result/"></script>
</div>

Uma versão um pouco mais compacta (e obscura, mas ainda assim muito utilizada):

<div>
<script async src="http://jsfiddle.net/65j26erk/embed/js,html,result/"></script>
</div>

A última solução usa uma IIFE (immediately-invoked function expression, ou expressão de função invocada imediatamente).

<!-- ********************** START OF EXERCISE ********************** -->
<!-- Just to avoid bugs :p -->
<div style="display:none;" id="START-EXERCISE"></div>
<div style="display:none;" id="END-EXERCISE"></div>
<!-- ********************** END OF EXERCISE *********************** -->

</xmp>
<!--- DEFINE END OF THE MARKDOWN AREA -->

<!-- Nice librarie for functional programming -->
<script type="text/javascript" src="assets/underscore/underscore-min.js"></script>

<!-- Libraries for interface -->
<script src="assets/strapdown/v/0.2/strapdown.js"></script>
<script src="assets/codemirror/codemirror.js"></script>
<!-- Some code mirrors addons -->
<script src="assets/codemirror/javascript.js"></script>
<script src="assets/codemirror/addons/matchbrackets.js"></script>
<script src="assets/codemirror/addons/autorefresh.js"></script>
<script src="assets/codemirror/addons/javascript-hint.js"></script>
<script src="assets/codemirror/addons/jshint.js"></script>
<script src="assets/codemirror/addons/javascript-lint.js"></script>
<script src="assets/codemirror/addons/lint.js"></script>
<script src="assets/codemirror/addons/show-hint.js"></script>
<script src="assets/codemirror/addons/fullscreen.js"></script>
<script src="assets/codemirror/addons/active-line.js"></script>

<!-- APP LIBRARIES --> 
<script src="assets/app/wordlist.js"></script>
<script src="assets/app/xhr_atomic.js"></script>
<!-- <script src="assets/app/utils.js"></script> -->
<!-- <script src="assets/app/main.js"></script> -->

<script type="text/javascript">
	// Hide the remain exercises without remove markdown support
	// Remember to use functional paradigm :p
	(function (){
		var x = document.getElementById("START-EXERCISE");
		while(x.nextElementSibling.id != "END-EXERCISE"){
			x.style.display = "none";
			x = x.nextElementSibling;
		}

		// Since text area only have javascript code, is not necessary left "<a href="">"
		// , or "<em>" 
		x = document.getElementsByClassName("code");
		_.each(x, el => {
			el.value = el.value.replace(/(<a\ href=").*(">)/g, 		"");
			el.value = el.value.replace(new RegExp("</a>", 'g'), 	"");
			el.value = el.value.replace(new RegExp("<em>", 'g'), 	"*");
			el.value = el.value.replace(new RegExp("</em>", 'g'), 	"*");
		});
	})();

	// Remove scripts not loaded, and try to reload all of them
	(function (){
		var x = document.getElementById("content");
		var s = x.getElementsByTagName("script");
		_.each(s, (el) => {
			// Capture the parent element
			var b = el.parentElement;
			// Create a new script element
			var n = document.createElement("script");

			// Add attributes from the previous child, remove from the parrent and
			// add the new one
			b.removeChild(el);
			n.async = true;
			n.src = el.src + "?pikachu";
			b.appendChild(n); 
			
			// Allow modals sandboxed
			// See http://stackoverflow.com/questions/32119446/ignored-call-to-alert-the-document-is-sandboxed-and-the-allow-modals-key
			(function(){
				var x = document.getElementsByTagName("iframe");
				_.each(x, (el) =>{
					el.sandbox += ' allow-modals';
				});
			})();
		});
	})();


	var codeMirrorEditors = [];
	var lessons = document.getElementsByClassName("lesson");

	function scrollTo(element, to, duration) {
	    var difference 	= (to + 60) - element.scrollTop;
	    var perTickSize = (difference / duration).toFixed();
	    var perTickTime = (duration / difference).toFixed(2);
	    var pageHeight	= window.innerHeight;

	    console.log("St = " + perTickSize + " | Ts = " + perTickTime + " | S = " + difference + " | D = " + duration);

	    var scrollingId = setInterval( _ => {
	    	if((duration <= 0) || ((pageHeight + element.scrollTop) > element.offsetHeight)){
	    		clearInterval(scrollingId);
	    		return;
	    	}
	    	console.log(element.scrollTop);
	    	duration -= perTickTime;
	    	element.scrollTop = element.scrollTop + perTickSize;
	    }, perTickTime);		
	}

	_.each(lessons, function (el){
		var code = el.children[0];
		var output = el.children[1];
		var info = el.children[2]; 
		var verifierScript = el.children[3].textContent;
		var debugDiv = el.children[4];
		var go = el.children[5];
		var showDebug = el.children[6];

		code.style.visibility = null;
		code.style.display = null;

		console.log(debugDiv);

		debugDiv.children[3].onkeydown = ((ev) => {
			if(ev.keyCode == 13){
				var valor = ev.target.value;
				ev.target.value = "";
				console.log(valor);
				return false;
			}});

		CodeMirror.defaults.lint = true;

		var codeMirror = CodeMirror.fromTextArea(code, {
			    lineNumbers: true,
			    mode: "javascript",
			    gutters: ["CodeMirror-lint-markers"],
			    lint: true,
				matchBrackets: true,
				autoRefresh: true,
				tabSize: 4,
				//styleActiveLine: true,
				indentWithTabs: false,
				hint: true,
				extraKeys: {
					"F4": function(cm) {
						cm.setOption("fullScreen", !cm.getOption("fullScreen"));
					},
					"Esc": function(cm) {
						if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
					},
					"Ctrl-Space": "autocomplete"
				}
			});

		codeMirrorEditors.push(codeMirror);

		configureReadOnlyLines(codeMirror);

		go.onclick = (ev) =>  {
			console.log("EVENT OK!");
			console.log(ev);
			try{
				var verificador = eval("(" + verifierScript + ")");
				output.textContent = verificador(codeMirror.getValue(), info, el);
			} catch (ex) {
				alert(ex);
			}

			if((output.textContent !== "Success!") && (output.textContent !== "YUPPPEEEE!")){
				output.className = "error";
				output.textContent = "Error!";
				return;
			}

			output.className = "success";
			info.className = "output";

			var p = ev.target.parentElement.nextElementSibling;
			while(!p.id.startsWith("lessonB")){
				p = p.nextElementSibling;
			}

			p = p.nextElementSibling;
			while(!p.id.startsWith("lessonE")){
				p.style.display = "";
				p = p.nextElementSibling;
			}

			//scrollTo(document.body, output.offsetTop, 600);
		};

		showDebug.onclick = (ev) => {
			console.log(debugDiv.className);
			ev.target.innerHTML = debugDiv.className == "output" ? "Hide Console" : "Show Console"; 
			debugDiv.className = debugDiv.className == "output" ? "console-log" : "output";
		};
	});

	var input = document.getElementById("select");
	function selectTheme() {
		var theme = input.options[input.selectedIndex].textContent;
		_.each(codeMirrorEditors, el => {
			el.setOption("theme", theme)
		});
		location.hash = "#" + theme;
	}
	var choice = (location.hash && location.hash.slice(1)) ||
	             (document.location.search &&
	             decodeURIComponent(document.location.search.slice(1)));
	if (choice) {
		input.value = choice;
		_.each(codeMirrorEditors, el => {
			el.setOption("theme", choice)
		});
	}
	CodeMirror.on(window, "hashchange", function() {
		var theme = location.hash.slice(1);
		if (theme) {
			input.value = theme;
			selectTheme();
		}
	});

	// After all page got rendered remove loader
	document.body.classList.add("loaded");
	document.styleSheets[49].ownerNode.id = "pagetheme";

	/**
	 * This function assumes that lines containing three consecutive
	 * slahes (---) are markers to delimit read-only text.
	 * If a marker exists, then all lines not between consecutive markers
	 * become read-only.
	 * Example:
	 * <textarea>
	 *   This line is read-only
	 *   ---
	 *   This line is read-write
	 *   ---
	 *   This line is also read-only
	 * </textarea>
	 */
	function configureReadOnlyLines(codeMirrorEditor) {
		var i,
			doc = codeMirrorEditor.doc,
			lines = doc.children[0].lines.map(line => line.text);
			separatorIndices = _.range(lines.length).filter(idx => lines[idx].indexOf("---") != -1);

		if (separatorIndices.length > 0) {
			separatorIndices = [0].concat(separatorIndices, lines.length - 1);
			for (i = 0; i < separatorIndices.length - 1; i += 2) {
				doc.markText({line: separatorIndices[i], ch: 0},
					{line: separatorIndices[i + 1] + 1, ch: 0},
					{readOnly: true, css: "opacity: 0.6"});
			}
		}
	}

	// Allow change theme page
	function selectThemePage(element){
		var sheet = document.getElementById("pagetheme");
		refname = sheet.href;

		document.body.classList.remove("loaded");
		sheet.href = refname.replace(/\/themes\/.*/g, "/themes/" + element.value + ".min.css");
		setTimeout(_ => {document.body.classList.add("loaded")}, 350);
	}

	/**
	 * This function allow save progress on dontpad.com, which is not exactly secure, but works
	 * pretty well. They work saving answered questions in two uri, the first URI represent a
	 * database with all answered questions, and the second is a hash with a backup of the entries
	 * in the first database:
	 * Example
	 *    	> dontpad.com/MATA56/id/{:hash(user, salt)} 	- Database with individual forms by id
	 *    	> dontpad.com/{:hash(user, pass, salt)} 		- Backup entry
	 * We recommend that you save your progress and upload to an online storage like dropbox, google
	 * or skydrive, because dontpad.com is not safe and we can't ensure that your data is really
	 * secure. Now use this only to save your progress, and create a form to send all the answers or
	 * maybe just the desired ones, it will be much faster and secure than this solution.
	 */
	function saveProgressDontpad(){

	}

	/**
	 * Instantiate the object "login" and start save progress
	 */
	function loginDontpad(){

	}

	/**
	 * Send answers to a google form
	 */
	function sendAnswers(){

	}
</script>

<!-- <script src="assets/app/surprise.js"></script> -->

</html>
<!-- TODO
	+ Remember to use jekyll, I think it's a good idea for clean the code
	+ USE http://myjson.com/api to store JSON with progress of each student
	+ USE https://ihatetomatoes.net/create-custom-preloading-screen/ while markdown is parsed and content are hidding
-->